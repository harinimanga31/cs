#firewall.py

import requests
import csv
import subprocess

# source = Abuse CH
response = requests.get(
    "https://feodotracker.abuse.ch/downloads/ipblocklist.csv"
).text

# Delete old firewall rule
rule = "netsh advfirewall firewall delete rule name='random'"
subprocess.run(["powershell", "-Command", rule])

# Read CSV, ignore comment lines
mycsv = csv.reader(
    filter(lambda x: not x.startswith("#"), response.splitlines())
)

for row in mycsv:
    ip = row[1]               # destination IP column
    if ip != "dst_ip":        # skip header row
        print("Added Rule to block:", ip)
        rule = "netsh advfirewall firewall add rule name='random' Dir=Out Action=Block RemoteIP=" + ip
        subprocess.run(["powershell", "-Command", rule])
        rule = "netsh advfirewall firewall add rule name='random' Dir=Out Action=Block RemoteIP=" + ip
            
        subprocess.run(["powershell", "-Command", rule])




 
